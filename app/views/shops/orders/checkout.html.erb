<h1 class="text-2xl font-semibold mb-4">Confirm Order</h1>

<% if flash[:alert] %>
  <div class="mb-4 rounded bg-red-100 text-red-700 px-4 py-2">
    <%= flash[:alert] %>
  </div>
<% elsif flash[:notice] %>
  <div class="mb-4 rounded bg-emerald-100 text-emerald-700 px-4 py-2">
    <%= flash[:notice] %>
  </div>
<% end %>

<div class="space-y-4">
  <% @cart_items.each do |item| %>
    <section class="border rounded px-4 py-3">
      <header class="flex items-center justify-between">
        <div>
          <h2 class="text-xl font-medium"><%= item[:product].name %></h2>
          <% if item[:size]&.size %>
            <p class="text-gray-600">Size: <%= item[:size].size.name %></p>
          <% end %>
        </div>
        <%= button_to "Remove",
                      shops_cart_item_path(item[:id]),
                      method: :delete,
                      class: "text-sm text-red-600",
                      data: { turbo: false } %>
      </header>

      <div class="mt-3 grid gap-3 md:grid-cols-2">
        <div>
          <p class="font-semibold">Ingredients</p>
          <ul class="list-disc list-inside text-gray-700">
            <% item[:ingredients].each do |ingredient| %>
              <li>
                <%= ingredient[:product_component].component.name %>
                — <%= ingredient[:portion].humanize %>
              </li>
            <% end %>
          </ul>
        </div>

        <div>
          <p class="font-semibold">Extras</p>
          <% if item[:extras].any? %>
            <ul class="list-disc list-inside text-gray-700">
              <% item[:extras].each do |extra| %>
                <li>
                  <%= extra[:product_component].component.name %>
                  — <%= extra[:portion].humanize %>
                </li>
              <% end %>
            </ul>
          <% else %>
            <p class="text-gray-600">No optional extras for this product.</p>
          <% end %>
        </div>
      </div>
    </section>
  <% end %>
</div>

<div class="mt-6 flex flex-col gap-3 md:flex-row">
  <%= button_to "Save order",
                commit_shops_orders_path,
                method: :post,
                class: "bg-emerald-600 text-white px-4 py-2 rounded text-center",
                data: { turbo: false } %>
  <%= link_to "Back to catalog", new_shops_order_path, class: "text-indigo-600 text-center px-4 py-2" %>
</div>
